import{r as e,R as t,a as o}from"./vendor.3da7a605.js";const r=29,l=29;function n(){const o=e.exports.useRef(null),n=e.exports.useRef((()=>{const e=[];for(let t=0;t<28;t++){const t=[];for(let e=0;e<28;e++)t.push(null);e.push(t)}return e})()),c=e.exports.useRef({x:0,y:0,lastX:0,lastY:0}),a=e.exports.useRef(),s=e.exports.useCallback(((e,t,o,c)=>{if(t>=l||o>=r)return;const i=n.current;let d,u,h,f;a.current,o+1<28&&(h={row:t,col:o+1,direction:"right"}),t+1<28&&(f={row:t+1,col:o,direction:"bottom"}),o-1>=0&&(d={row:t,col:o-1,direction:"left"}),t-1>=0&&(u={row:t-1,col:o,direction:"top"});let y=new Set;if(!i[t][o]){switch(c){case"left":y.add("right");break;case"right":y.add("left");break;case"top":y.add("bottom");break;case"bottom":y.add("top")}i[t][o]={x:20*(o+1),y:20*(t+1),leadTo:y}}const v=[d,u,h,f].filter((e=>{if(e){const{row:t,col:o}=e;return!i[t][o]}return!1}));if(!(null==v?void 0:v.length))return;const x=i[t][o],b=Math.floor(Math.random()*v.length),k=v.splice(b,1)[0],m=null==k?void 0:k.direction,g=null==k?void 0:k.row,p=null==k?void 0:k.col;switch(m){case"left":x.leadTo.add("left"),e.clearRect(x.x-1,x.y+1,2,20);break;case"right":x.leadTo.add("right"),e.clearRect(x.x+20-1,x.y+1,2,20);break;case"top":x.leadTo.add("top"),e.clearRect(x.x+1,x.y-1,20,2);break;case"bottom":x.leadTo.add("bottom"),e.clearRect(x.x+1,x.y+20-1,20,2)}s(e,g,p,m),v.forEach((r=>{s(e,t,o,0)}))}),[]);e.exports.useEffect((()=>{const e=null==o?void 0:o.current,t=o=>{var r,l,a,s;const i=c.current,d=null==e?void 0:e.getContext("2d"),u=n.current;if(d){let e;const n=u[i.y][i.x];switch(d.clearRect(n.x+2,n.y+2,15,15),null==o?void 0:o.key){case"ArrowLeft":(null==(r=null==n?void 0:n.leadTo)?void 0:r.has("left"))&&(e=i.x-1,e<0&&(e=0),i.x=e);break;case"ArrowUp":(null==(l=null==n?void 0:n.leadTo)?void 0:l.has("top"))&&(e=i.y-1,e<0&&(e=0),i.y=e);break;case"ArrowRight":(null==(a=null==n?void 0:n.leadTo)?void 0:a.has("right"))&&(e=i.x+1,e>27&&(e=27),i.x=e);break;case"ArrowDown":(null==(s=null==n?void 0:n.leadTo)?void 0:s.has("bottom"))&&(e=i.y+1,e>27&&(e=27),i.y=e)}const{x:c,y:h}=i;d.beginPath(),d.strokeStyle="red",d.arc(u[h][c].x+10,u[h][c].y+10,5,0,2*Math.PI),d.closePath(),d.stroke(),27===c&&27===h&&(alert("到达终点"),document.removeEventListener("keydown",t))}};if(e){const o=null==e?void 0:e.getContext("2d");document.addEventListener("keydown",t),o&&((e=>{const t=20,o=580;e.beginPath(),e.lineWidth=1,e.moveTo(t,t),e.lineTo(o,t),e.lineTo(o,o),e.lineTo(t,o),e.lineTo(t,t),e.stroke();for(let l=2;l<r;l++)e.beginPath(),e.moveTo(l*t,t),e.lineTo(l*t,o),e.stroke(),e.beginPath(),e.moveTo(t,l*t),e.lineTo(o,l*t),e.stroke()})(o),s(o,0,0,0),(e=>{const{x:t,y:o}=c.current,r=n.current;e.beginPath(),e.strokeStyle="red",e.arc(r[o][t].x+10,r[o][t].y+10,5,0,2*Math.PI),e.closePath(),e.stroke(),e.beginPath(),e.strokeStyle="green",e.rect(r[27][27].x+4,r[27][27].y+4,12,12),e.closePath(),e.stroke()})(o))}return()=>{document.removeEventListener("keydown",t)}}),[]);const i=(e,t,o,r,l)=>{const c=n.current;let s=l;const d=c[o][t];if(r.push({x:t,y:o}),a.current)return;if(27===t&&27===o)return void(a.current=r.slice());const u=Array.from(d.leadTo.keys()).filter((e=>e!==s));u.length&&u.forEach((l=>{let n=t,c=o;switch(l){case"left":n-=1,s="right";break;case"right":n+=1,s="left";break;case"bottom":c+=1,s="top";break;case"top":c-=1,s="bottom"}i(e,n,c,r,s),r.pop()}))},d=e.exports.useCallback((async()=>{const e=null==o?void 0:o.current,t=null==e?void 0:e.getContext("2d"),r=c.current,{x:l,y:s}=r;if(t){await i(t,l,s,[],"");const e=a.current,o=n.current;for(let r=1;r<(null==e?void 0:e.length);r++){const l=e[r].x,n=e[r].y;t.beginPath(),t.fillStyle="aqua",t.fillRect(o[n][l].x+4,o[n][l].y+4,12,12),t.closePath()}}}),[]);return t.createElement(t.Fragment,null,t.createElement("button",{onClick:d},"展示通向终点的路径"),t.createElement("canvas",{ref:o,width:600,height:600},"您的浏览器不支持canvas."))}o.render(t.createElement(t.StrictMode,null,t.createElement(n,null)),document.getElementById("root"));
